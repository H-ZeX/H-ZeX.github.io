<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=7.0.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    showProcessingMessages: false,
    messageStyle: "none",
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
        inlineMath:  [ ["$", "$"] ],
        displayMath: [ ["$$","$$"] ],
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code','a'],
        ignoreClass:"comment-content"
    },
    "HTML-CSS": {
        availableFonts: ["STIX","TeX"],
        showMathMenu: false
    }
});
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>
<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  




  <meta name="description" content="本笔记大部分是《深入理解java虚拟机第二版》的笔记，该书基于java1.7  Override 准确式内存管理：即虚拟机可以知道内存中某个位置的数据具体是什么类型   运行时数据区域 方法区  线程共享  存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等  虚拟机规范把方法区描述为堆的一个逻辑部分（但是有一个别名：Non-Heap）  HotSpot用永久代实现。其他虚拟机">
<meta property="og:type" content="article">
<meta property="og:title" content="My JVM Note">
<meta property="og:url" content="https://h-zex.github.io/2019/03/02/JVM-Note/index.html">
<meta property="og:site_name" content="H-ZeX">
<meta property="og:description" content="本笔记大部分是《深入理解java虚拟机第二版》的笔记，该书基于java1.7  Override 准确式内存管理：即虚拟机可以知道内存中某个位置的数据具体是什么类型   运行时数据区域 方法区  线程共享  存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等  虚拟机规范把方法区描述为堆的一个逻辑部分（但是有一个别名：Non-Heap）  HotSpot用永久代实现。其他虚拟机">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-07-02T15:41:12.548Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My JVM Note">
<meta name="twitter:description" content="本笔记大部分是《深入理解java虚拟机第二版》的笔记，该书基于java1.7  Override 准确式内存管理：即虚拟机可以知道内存中某个位置的数据具体是什么类型   运行时数据区域 方法区  线程共享  存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等  虚拟机规范把方法区描述为堆的一个逻辑部分（但是有一个别名：Non-Heap）  HotSpot用永久代实现。其他虚拟机">



  <link rel="alternate" href="/atom.xml" title="H-ZeX" type="application/atom+xml"/>




  <link rel="canonical" href="https://h-zex.github.io/2019/03/02/JVM-Note/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>My JVM Note | H-ZeX</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-137821328-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-137821328-1');
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">H-ZeX</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">H-ZeX's Coding Life</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-友情链接">

    
    
    
      
    

    

    <a href="/link" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i> <br/>友情链接</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://h-zex.github.io/2019/03/02/JVM-Note/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="H-ZeX"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="H-ZeX"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">My JVM Note

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-02 12:49:04" itemprop="dateCreated datePublished" datetime="2019-03-02T12:49:04+08:00">2019-03-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-02 23:41:12" itemprop="dateModified" datetime="2019-07-02T23:41:12+08:00">2019-07-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JAVA/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <a href="/2019/03/02/JVM-Note/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/2019/03/02/JVM-Note/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>本笔记大部分是《深入理解java虚拟机第二版》的笔记，该书基于java1.7</p>
</blockquote>
<h3 id="Override"><a href="#Override" class="headerlink" title="Override"></a>Override</h3><ul>
<li>准确式内存管理：即虚拟机可以知道内存中某个位置的数据具体是什么类型</li>
<li></li>
</ul>
<h3 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h3><ul>
<li><p>方法区</p>
<ul>
<li><p>线程共享</p>
</li>
<li><p>存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等</p>
</li>
<li><p>虚拟机规范把方法区描述为堆的一个逻辑部分（但是有一个别名：Non-Heap）</p>
</li>
<li><p>HotSpot用永久代实现。其他虚拟机并没有永久代这个概念</p>
<blockquote>
<p>但使用永久代来实现方法区，现在看来并不是一个好主意，因为这样更容易遇到内存溢出问题（永久代有<code>-XX:MaxPermSize</code>的上限，J9和JRockit只要没有触碰到进程可用内存的上限，例如32位系统中的4GB，就不会出现问题），而且有极少数方法（例如<code>String.intern()</code>）会因这个原因导致不同虚拟机下有不同的表现。</p>
</blockquote>
</li>
<li><p>规范要求，可以不需要连续的内存（连续的的物理内存？），可以固定大小或可扩展，可以不实现垃圾收集</p>
</li>
<li><p>有OutOfMemoryError异常</p>
</li>
</ul>
</li>
<li>运行时常量池<ul>
<li>方法区的一部分</li>
<li>class文件中的常量池在类加载后就放入这里</li>
<li>规范没有做细节要求。一般来说,除了保存Class文件中描述的符号引用外,还会把翻译出来的直接引用也存储在运行时常量池中</li>
<li>具有动态性。运行期可以把新的常量放进池中（比如<code>String.intern()</code>）</li>
</ul>
</li>
<li><p>直接内存</p>
<ul>
<li><p>不是虚拟机运行时数据区的一部分，也不是规范中定义的内存区域</p>
</li>
<li><p>NIO可以直接操作堆外的内存</p>
<blockquote>
<p>在JDK1.4中新加入了NIO（NewInput/Output）类，引入了一种基于通道（Channel）与缓冲区（Buffer）的I/O方式，它可以使用Native函数库直接分配堆外内存，然后通过一个存储在Java堆中的DirectByteBuffer对象作为这块内存的引用进行操作。这样能在一些场景中显著提高性能，因为避免了在Java堆和Native堆中来回复制数据。</p>
</blockquote>
</li>
<li><p>可能出现OOM异常</p>
</li>
<li><p>这里的内存溢出，明显的特征是HeapDum文件中不会看到明显的异常，并且可能Dump文件很小</p>
</li>
</ul>
</li>
<li>堆<ul>
<li>存放对象实例</li>
<li>垃圾收集器管理的主要区域</li>
<li>线程共享。虚拟机启动时创建</li>
<li>可以划分出多个线程私有的分配缓冲区</li>
<li>有OutOfMemoryError异常</li>
<li>规范要求，可以处于物理上不连续的内存空间，只要逻辑上连续即可。可以是可扩展或固定大小</li>
</ul>
</li>
<li>虚拟机栈<ul>
<li>线程私有。生命周期与线程相同</li>
<li>栈帧中有：局部变量表（方法运行期不会改变大小，存有基本数据类型、对象引用、returnAddress类型）、操作数栈、动态链接、方法出口等信息</li>
<li>方法调用对应于一个栈帧在虚拟机栈的入栈到出栈过程</li>
<li>有StackOverflowError异常、OutOfMemoryError异常（只有可以动态扩展虚拟机栈的虚拟机再有OOM异常）</li>
</ul>
</li>
<li>本地方法栈<ul>
<li>类似于虚拟机栈</li>
<li>线程私有、生命周期与线程相同</li>
<li>具体的虚拟机可以自由实现</li>
<li>有StackOverflowError和OutOfMemoryError异常</li>
<li>在HotSpot虚拟机中并不区分虚拟机栈和本地方法栈</li>
</ul>
</li>
<li>程序计数器<ul>
<li>线程私有、生命周期与线程相同</li>
<li>没有任何OutOfMemoryError情况</li>
</ul>
</li>
</ul>
<h3 id="HotSpot在Java堆中对象的创建、布局、访问"><a href="#HotSpot在Java堆中对象的创建、布局、访问" class="headerlink" title="HotSpot在Java堆中对象的创建、布局、访问"></a><strong>HotSpot</strong>在Java堆中对象的创建、布局、访问</h3><h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><blockquote>
<p>以下仅限于普通对象，不包括数组和class对象</p>
</blockquote>
<ul>
<li>当遇到new指令时<ul>
<li>在常量池定位这个类的符号引用，并检查该类是否已被加载、解析和初始化过。如果没有要执行对应的加载过程</li>
<li>为新生对象分配内存（指针碰撞、空闲列表、TLAB）（在类加载后对象所需的内存便可完全确定）</li>
<li>把分配到的内存空间都初始为0值（如果是TLAB，可以提前到TLAB分配时进行）</li>
<li>设置对象头（哪个类的实例、如何找到类的元数据信息、对象的hashCode、对象的GC分代年龄等。根据是否启用偏向锁，对象头会有不同的设置方式）</li>
<li>截止以上，从虚拟机的角度看，新对象已经产生了</li>
<li>一般来说（由字节码中是否跟随invokespecial指令所决定），执行new指令之后会接着执行<code>&lt;init&gt;</code> 方法， 把对象按照程序员的意愿进行初始化， 这样一个真正可用的对象才算完全产生出来</li>
</ul>
</li>
</ul>
<h5 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h5><ul>
<li>对象在内存中的布局有：对象头、实例数据、对齐填充</li>
<li>对象头<ul>
<li>第一部分用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等</li>
<li>第二部分是类型指针，即指向类元数据的指针</li>
<li>如果是数组，还要有一块用于记录长度</li>
</ul>
</li>
<li>实例数据<ul>
<li>程序代码中所定义的各种类型的字段内容（包括从父类继承和子类中定义的）</li>
<li>存储顺序会受到虚拟机分配策略参数（FieldsAllocationStyle） 和字段在Java源码中定义顺序的影响</li>
<li>默认的分配策略是<ul>
<li>相同宽度字段被分配在一起<ul>
<li><code>longs/doubles</code></li>
<li><code>ints</code></li>
<li><code>shorts/chars</code></li>
<li><code>bytes/booleans</code></li>
<li><code>oops</code>(ordinary object pointers)（有个问题，指针不是64bit吗？）</li>
</ul>
</li>
<li>满足上面那个条件后，父类定义的出现在子类之前</li>
<li>如果CompactFields参数值为true（默认为true），那么子类之中较窄的变量也可能会插入到父类变量的空隙之中</li>
</ul>
</li>
</ul>
</li>
<li>padding<ul>
<li>由于HotSpot VM的自动内存管理系统要求对象起始地址必须是8字节的整数倍，所以可能需要padding</li>
</ul>
</li>
</ul>
<h5 id="定位和访问"><a href="#定位和访问" class="headerlink" title="定位和访问"></a>定位和访问</h5><ul>
<li>HotSpot使用直接指针。另一种方式是句柄（不是HotSpot采用的）</li>
<li>句柄<ul>
<li>需要在java堆中有句柄池</li>
<li>句柄中包含对象的实例数据和类型数据的各自具体地址</li>
<li>在对象被移动时，无需更新reference数据</li>
</ul>
</li>
</ul>
<h3 id="类加载的时机"><a href="#类加载的时机" class="headerlink" title="类加载的时机"></a>类加载的时机</h3><blockquote>
<p>注意，这一部分JVM有明确规定，但不知道是否有一些是实现相关的。我试验时用的是HotSpot，openJDK 1.8，client模式下</p>
</blockquote>
<ul>
<li><p>按照作者说法</p>
<blockquote>
<p>常量在编译阶段会存入调用类的常量池中，本质上并没有直接引用到定义常量的类，因此不会触发定义常量的类的初始化</p>
</blockquote>
<p>在实验中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InitTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(Holder.str3);</span><br><span class="line">        <span class="comment">// 如果是输出str，则不会输出`Init Holder`</span></span><br><span class="line">        <span class="comment">// 如果是输出str2和str3则会</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String str = <span class="string">"Hello"</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String str2 = <span class="keyword">new</span> String(<span class="string">"NewString"</span>);</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String str3 = String.valueOf(<span class="string">"Str3"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Init Holder"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="HotSpot-VM的结构"><a href="#HotSpot-VM的结构" class="headerlink" title="HotSpot VM的结构"></a>HotSpot VM的结构</h3><ul>
<li>GC（可插拔）</li>
<li>JIT（可插拔）</li>
<li>runtime</li>
</ul>
<h3 id="HotSpot-Runtime"><a href="#HotSpot-Runtime" class="headerlink" title="HotSpot Runtime"></a>HotSpot Runtime</h3><h5 id="职责"><a href="#职责" class="headerlink" title="职责"></a>职责</h5><ul>
<li>parsing of command line arguments</li>
<li>VM life cycle</li>
<li>class loading,</li>
<li>byte code interpreter</li>
<li>exception handling</li>
<li>synchronization</li>
<li>thread management</li>
<li>Java Native Interface</li>
<li>VM fatal error handling</li>
<li>C++ (non-Java) heap management.</li>
</ul>
<h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><ul>
<li>程序计数器、虚拟机栈、本地方法栈3个区域需要的内存<strong>基本上</strong>在类结构确定时就已知（JIT优化会有所改变），并且生命周期与线程、方法的进入退出相同，所以内存回收是确定的</li>
<li>java堆和方法区需要的内存则需要运行时才知道，分配回收都是动态的，所以需要GC</li>
<li>吞吐量=运行用户代码时间/(运行用户代码时间+垃圾收集时间)</li>
</ul>
<h5 id="GC的3件事"><a href="#GC的3件事" class="headerlink" title="GC的3件事"></a>GC的3件事</h5><ul>
<li>哪些内存需要回收？</li>
<li>什么时候回收？</li>
<li>如何回收？</li>
</ul>
<h5 id="可作为CG-Roots的对象"><a href="#可作为CG-Roots的对象" class="headerlink" title="可作为CG Roots的对象"></a>可作为CG Roots的对象</h5><ul>
<li>虚拟机栈（栈帧中的本地变量表） 中引用的对象</li>
<li>方法区中类静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>本地方法栈中JNI（即一般说的Native方法） 引用的对象</li>
</ul>
<h5 id="强、软、弱、虚引用"><a href="#强、软、弱、虚引用" class="headerlink" title="强、软、弱、虚引用"></a>强、软、弱、虚引用</h5><ul>
<li>强引用：只要还存在，GC永远不会回收被引用对象</li>
<li>软引用：对于软引用关联着的对象，在系统将要发生内存溢出异常之前，将会把这些对象列进回收范围之中进行第二次回收。如果这次回收还没有足够的内存，才会抛出内存溢出异常</li>
<li>弱引用：被弱引用关联的对象只能生存到下一次垃圾收集发生之前。当垃圾收集器工作时，无论当前内存是否足够，都会回收掉只被弱引用关联的对象</li>
<li>虚引用：也称为幽灵引用或者幻影引用，它是最弱的一种引用关系。一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。为一个对象设置虚引用关联的唯一目的就是能在这个对象被收集器回收时收到一个系统通知</li>
</ul>
<h5 id="Hotspot-GC"><a href="#Hotspot-GC" class="headerlink" title="Hotspot GC"></a>Hotspot GC</h5><ul>
<li><p>Minor GC：新生代的GC，Eden空间的存活对象和from survivor空间的不够老的存活对象复制到to survivor空间，from survivor空间中足够老的对象提升为老年代。结束后，Eden空间一般是全空的（也有不空的情况）。只要追求速度，空间利用率会低一些</p>
</li>
<li><p>Major GC（Full GC）：老年代GC, Major GC经常会伴随至少一次的Minor GC（但非绝对的， 在Parallel Scavenge收集器的收集策略里就有直接进行Major GC的策略选择过程） 。 Major GC的速度一般会比Minor GC慢10倍以上</p>
<blockquote>
<p><em>java performance</em> HotSpot中译本P57注释有</p>
<p>“实际上，HotSpot VM的FullGC收集整个堆，包括新生代、老年代、永生代”</p>
</blockquote>
</li>
<li><p>过早提升：Minor GC时，to survivor空间不足，所以多余对象移到老年代</p>
</li>
<li><p>提升失败：Minor GC过程中，老年代满了，所以需要Full GC（这需要遍历整个java堆）</p>
</li>
<li><p>大对象可能直接分配到老年代</p>
</li>
</ul>
<h6 id="各种GC"><a href="#各种GC" class="headerlink" title="各种GC"></a>各种GC</h6><ul>
<li><p>Serial</p>
<ul>
<li>单线程Stop-The-World式收集器</li>
<li>新生代使用复制收集算法（如同上面MinorGC那里描述的那样）</li>
<li>可以与CMS配合</li>
<li>应用场景<ul>
<li>如果一台机器上有多个JVM（可能比CPU核数还多），那么使用Serial就很好。</li>
<li>client模式下新生代的默认收集器（jdk7时？）</li>
</ul>
</li>
</ul>
</li>
<li><p>Serial Old</p>
<ul>
<li><p>单线程Stop-The-World式收集器</p>
</li>
<li><p>Serial的老年代版本</p>
</li>
<li><p>使用标记清除压缩收集算法，回收时找出所有的存活对象，然后滑动到堆的头部</p>
</li>
<li><p>应用场景</p>
<ul>
<li><p>如果一台机器上有多个JVM（可能比CPU核数还多），那么使用Serial Old就很好。</p>
</li>
<li><p>主要给Client模式下的虚拟机用</p>
</li>
<li><p>在Server模式下,那么它主要还有两大用途</p>
<ul>
<li><p>一种用途是在JDK 1.5以及之前的版本中与Parallel Scavenge收集器搭配使用</p>
<blockquote>
<p>Parallel Scavenge收集器架构中本身有PS MarkSweep收集器来进行老年代收集,并非直接使用了Serial Old收集器,但是这个PS MarkSweep收集器与Serial Old的实现非常接近,所以在官方的许多资料中都是直接以Serial Old代替PS MarkSweep进行讲解</p>
</blockquote>
</li>
<li><p>另一种用途就是作为CMS收集器的后备预案,在并发收集发生Concurrent Mode Failure时使用</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ParNew:</p>
<ul>
<li>Serial的多线程版本（除了多线程，与Serial差别没有差别）</li>
<li>新生代的收集器</li>
<li>可以与CMS配合</li>
<li>应用场景<ul>
<li>运行于Server模式下的首选新生代收集器（jdk7时？），因为除了serial，只有它能与CMS配合</li>
</ul>
</li>
</ul>
</li>
<li><p>Parallel Scavenge</p>
<ul>
<li>又叫吞吐量优先处理器</li>
<li>新生代的收集器</li>
<li>多线程Stop-The-World式收集器，采用复制收集算法</li>
<li>Parallel Scavenge收集器的目标则是达到一个可控制的吞吐量</li>
<li>不能与CMS配合</li>
<li>自适应调节策略也是Parallel Scavenge收集器与ParNew收集器的一个重要区别</li>
<li>Parallel Scavenge收集器没有使用传统的GC收集器代码框架,而另外独立实现,其余几种收集器则共用了部分的框架代码</li>
<li><code>-XX:MaxGCPauseMillis</code>：参数设置最大垃圾收收集停顿时间。GC停顿时间缩短是以牺牲吞吐量和新生代空间来换取的，设得过小可能导致频繁GC</li>
<li><code>-XX:GCTimeRatio</code>：设置吞吐量，为大于0小于100的整数，设为$x$的含义是GC时间占$\frac{1}{x+1}$，默认是99</li>
<li><code>-XX:+UseAdaptiveSizePolicy</code>：打开后，就不需要手工指定新生代的大小(-Xmn)、Eden与Survivor区的比例、晋升老年代对象年龄等细节参数了</li>
</ul>
</li>
<li><p>Parallel Old</p>
<ul>
<li>Parallel Scavenge收集器的老年代版本</li>
<li>使用多线程和“标记-整理”算法</li>
<li>这个收集器是在JDK 1.6中才开始提供的，以前只能让Parallel Scavenge与Serial Old配合</li>
<li>在注重吞吐量以及CPU资源敏感的场合,都可以优先考虑Parallel Scavenge加Parallel Old收集器</li>
</ul>
</li>
<li><p>CMS(Concurrent Mark Sweep)</p>
<ul>
<li><p>老年代的收集器</p>
</li>
<li><p>以获取最短回收停顿时间为目标的收集器</p>
</li>
<li><p>使用多线程、标记-清除算法</p>
</li>
<li><p>它第一次实现了让垃圾收集线程与用户线程(基本上)同时工作</p>
</li>
<li><p>尽可能并发、低停顿式的收集器，独立于HotSpot分代式GC框架另行实现的并行收集器</p>
</li>
<li><p>整个过程分为四个步骤：初始标记、并发标记、重新标记、并发清除</p>
<blockquote>
<p>初始标记、重新标记这两个步骤仍然需要“Stop The World”。初始标记仅仅只是标记一下GC Roots能直接关联到的对象,速度很快,并发标记阶段就是进行GC RootsTracing的过程,而重新标记阶段则是为了修正并发标记期间因用户程序继续运作而导致标记产生变动的那一部分对象的标记记录,这个阶段的停顿时间一般会比初始标记阶段稍长一些,但远比并发标记的时间短。由于整个过程中耗时最长的并发标记和并发清除过程收集器线程都可以与用户线程一起工作</p>
</blockquote>
</li>
<li><p>缺点</p>
<ul>
<li><p>对CPU资源敏感（默认启动的回收线程是$(\text{CPU数量}+3)/4$）</p>
</li>
<li><p>由于在垃圾收集阶段用户线程还需要运行，所以无法处理浮动垃圾，可能出现<code>Concurrent Mode Failure</code>失败而导致另一次FullGC</p>
<blockquote>
<p>要是CMS运行期间预留的内存无法满足程序需要,就会出现一次<code>Concurrent Mode Failure</code>失败,这时虚拟机将启动后备预案:临时启用Serial Old收集器来重新进行老年代的垃圾收集,这样停顿时间就很长了</p>
</blockquote>
</li>
<li><p>由于在垃圾收集阶段用户线程还需要运行,那也就还需要预留有足够的内存空间给用户线程使用,因此CMS收集器不能像其他收集器那样等到老年代几乎完全被填满了再进行收集,需要预留一部分空间提供并发收集时的程序运作使用（可以通过<code>XX:CMSInitiatingOccupancyFraction</code>调高触发百分比，不过如果过高，就会出现<code>Concurrent Mode Failure</code>）</p>
</li>
<li><p>基于标记-清除算法，所以会有大量空间碎片，导致可能提前触发FullGC</p>
<blockquote>
<ul>
<li>为了解决这个问题,CMS收集器提供了一个<code>XX:+UseCMSCompactAtFullCollection</code>开关参数(默认就是开启的),用于在CMS收集器顶不住要进行FullGC时开启内存碎片的合并整理过程,内存整理的过程是无法并发的,空间碎片问题没有了,但停顿时间不得不变长</li>
<li>虚拟机设计者还提供了另外一个参数<code>-XX:CMSFullGCsBeforeCompaction</code>,这个参数是用于设置执行多少次不压缩的Full GC后,跟着来一次带压缩的(默认值为0,表示每次进入Full GC时都进行碎片整理)。</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>G1</p>
<ul>
<li>G1收集器没有使用传统的GC收集器代码框架,而另外独立实现,其余几种收集器则共用了部分的框架代码</li>
<li>面向服务端</li>
</ul>
</li>
</ul>
<h3 id="类加载"><a href="#类加载" class="headerlink" title="类加载"></a>类加载</h3><blockquote>
<p>在实际情况中， 每个Class文件都有可能代表着Java语言中的一个类或接口， 后文中直接对“类”的描述都包括了类和接口的可能性</p>
</blockquote>
<h5 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h5><ul>
<li>在Java语言里面，类型的加载、 连接和初始化过程都是在程序运行期间完成的， 这种策略虽然会令类加载时稍微增加一些性能开销， 但是会为Java应用程序提供高度的灵活性，例如在运行时才指定某个接口的实现类</li>
<li>验证、准备、解析三个部分统称为连接</li>
</ul>
<h5 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h5><ul>
<li>加载（loading）</li>
<li>验证</li>
<li>准备</li>
<li>解析</li>
<li>初始化</li>
<li>使用</li>
<li>卸载</li>
</ul>
<h5 id="ClassLoader例子"><a href="#ClassLoader例子" class="headerlink" title="ClassLoader例子"></a>ClassLoader例子</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ClassLoader myLoader = <span class="keyword">new</span> ClassLoader() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String fileName = name.substring(name.lastIndexOf(<span class="string">"."</span>) + <span class="number">1</span>) + <span class="string">".class"</span>;</span><br><span class="line">            InputStream is = getClass().getResourceAsStream(fileName);</span><br><span class="line">            <span class="keyword">if</span> (is == <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"use super loader"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.loadClass(name);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()];</span><br><span class="line">            is.read(b);</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><blockquote>
<p>以下可能有HotSpot专有的参数</p>
</blockquote>
<ul>
<li><p><code>-Xms</code>： the initial memory sizes available to the JVM</p>
</li>
<li><p><code>-Xmx</code>： the maximum memory sizes available to the JVM</p>
</li>
<li><p><code>-Xms</code>, <code>-Xmx</code>：用于JVM heap。Increasing the amount of memory available can improve performance, but increasing it to too high a value can have a detrimental effect in the form of longer pauses for full garbage collection runs. Therefore, the initial and maximum sizes should be set to the same value.</p>
</li>
<li><p><code>-Xmn</code>：新生代大小</p>
</li>
<li><p><code>-XX:SurvivorRatio</code>：Eden与Survivor区的比例</p>
</li>
<li><p><code>-XX:PretenureSizeThreshold</code>：晋升老年代对象的年龄</p>
</li>
<li><p><code>-Xss</code>：栈容量</p>
</li>
<li><p><code>-Xoss</code>：本地方法栈大小（因为HotSpot不区分虚拟机栈和本地方法栈，所以该参数无效）</p>
</li>
<li><p><code>-XX:MaxDirectMemorySize</code>：本地直接内存的最大容量。默认与java堆最大值一样</p>
</li>
<li><p><code>-Xnoclassgc</code>：是否对类进行回收（HotSpot VM）</p>
</li>
<li><p><code>-verbose:class</code>, <code>-XX:+TraceClassLoading</code>, <code>-XX:+TraceClassUnLoading</code>：查看类加载卸载信息。第三个需要FastDebug版虚拟机支持</p>
</li>
<li><p><code>-XX:+/-UseTLAB</code>：是否启用本地线程分配缓存</p>
</li>
<li><p><code>Xlog:gc*</code>, <code>-XX:+PrintGCDetails</code>：打印GC日志</p>
</li>
<li><p><code>-XX:MaxTenuringThreshold</code>：晋升老年代的年龄阀值</p>
</li>
<li><p><code>-XX:+PrintReferenceGC</code>：GC时打印finalReference的信息</p>
</li>
<li><p><code>-XX:+PrintGCApplicationStoppedTime</code>：打印到达安全点的信息</p>
</li>
<li><p><code>-XX:UseCompressedOops</code>：开启压缩指针</p>
</li>
<li><p><code>-XX:PretenureSizeThreshold</code>：大于这个设置值的对象直接在老年代分配。这样做的目的是避免在Eden区及两个Survivor区之间发生大量的内存复制（因为新生代采用复制算法收集内存）</p>
<blockquote>
<p>PretenureSizeThreshold参数只对Serial和ParNew两款收集器有效， Parallel Scavenge收集器不认识这个参数， Parallel Scavenge收集器一般并不需要设置。 如果遇到必须使用此参数的场合，可以考虑ParNew加CMS的收集器组合。</p>
</blockquote>
</li>
</ul>
<h3 id="实验和调优"><a href="#实验和调优" class="headerlink" title="实验和调优"></a>实验和调优</h3><h5 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h5><ul>
<li>HotSpot，单线程下怎样测试都只抛出<code>StackOverflowError</code>，所以<code>StackOverflowError</code>应该不是因为调用深度超过某个值就抛出，而是内存不足导致抛出（所以相应减小栈上变量的总大小，可以提高栈深度）</li>
<li>如果是建立过多线程导致的内存溢出，在不能减少线程数或者更换64位虚拟机的情况下， 就只能通过减少最大堆和减少栈容量来换取更多的线程</li>
</ul>
<h5 id="GC-1"><a href="#GC-1" class="headerlink" title="GC"></a>GC</h5><ul>
<li>大对象对GC不友好，经常出现大对象容易导致内存还有不少空间时就提前触发垃圾收集以获取足够的连续空间来“安置”它们。写程序时应当避免“短命大对象”。</li>
</ul>
<h5 id="局部变量表的slot复用与GC"><a href="#局部变量表的slot复用与GC" class="headerlink" title="局部变量表的slot复用与GC"></a>局部变量表的slot复用与GC</h5><ul>
<li><p>代码1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">64</span>];</span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="comment">// gc后，placeHolder没有被gc掉</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">64</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="comment">// gc后，placeHolder没有被gc掉</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码3</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">64</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="comment">// gc后，placeHolder被gc掉</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><blockquote>
<p>如果遇到一个方法，其后面的代码有一些耗时很长的操作，而前面又定义了占用了大量内存、实际上已经不会再使用的变量，手动将其设置为null值（用来代替那句<code>int a=0</code>，把变量对应的局部变量表Slot清空）便不见得是一个绝对无意义的操作，这种操作可以作为一种在极特殊情形（对象占用内存大、此方法的栈帧长时间不能被回收、方法调用次数达不到JIT的编译条件）下的“奇技”来使用。</p>
</blockquote>
</li>
<li><blockquote>
<p>从编码角度讲， 以恰当的变量作用域来控制变量回收时间才是最优雅的解决方法， 如代码清单8-3那样的场景并不多见。 更关键的是， 从执行角度讲， 使用赋null值的操作来优化内存回收是建立在对字节码执行引擎概念模型的理解之上的，但是实际执行中，与概念模型差别很大，所以赋null可能无必要（然而我自己使用java11，上面那个测试代码，G1，似乎没有<code>int a=0</code>就没有回收）</p>
</blockquote>
</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/18/GF-2-n上算术运算的实现/" rel="next" title="$GF(2^n)$上算术运算的实现">
                <i class="fa fa-chevron-left"></i> $GF(2^n)$上算术运算的实现
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/04/java内部类、局部类的实现原理/" rel="prev" title="Java内部类、局部类的实现原理以及与内存可见性的关系">
                Java内部类、局部类的实现原理以及与内存可见性的关系 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">H-ZeX</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">38</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">68</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/H-ZeX" title="GitHub &rarr; https://github.com/H-ZeX" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:hzx20112012@gmail.com" title="E-Mail &rarr; mailto:hzx20112012@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Override"><span class="nav-text">Override</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行时数据区域"><span class="nav-text">运行时数据区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HotSpot在Java堆中对象的创建、布局、访问"><span class="nav-text">HotSpot在Java堆中对象的创建、布局、访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类加载的时机"><span class="nav-text">类加载的时机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HotSpot-VM的结构"><span class="nav-text">HotSpot VM的结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HotSpot-Runtime"><span class="nav-text">HotSpot Runtime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GC"><span class="nav-text">GC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类加载"><span class="nav-text">类加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数"><span class="nav-text">参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实验和调优"><span class="nav-text">实验和调优</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">H-ZeX</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: '2zewWM7OPwRwvylk6pRcPGm7-gzGzoHsz',
    appKey: 'qPGJQQgN9YMXkOQLEC97Ufhf',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  





  

  

  

  

  
  

  
  

  


  

  

  

  

  

  

  

  
  

  
  

  


</body>
</html>
